<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>A tutorial on the cumulative calibration assessment and the cumulcalib package</title>
<style type="text/css">
/**
 * Prism.s theme ported from highlight.js's xcode style
 */
pre code {
  padding: 1em;
}
.token.comment {
  color: #007400;
}
.token.punctuation {
  color: #999;
}
.token.tag,
.token.selector {
  color: #aa0d91;
}
.token.boolean,
.token.number,
.token.constant,
.token.symbol {
  color: #1c00cf;
}
.token.property,
.token.attr-name,
.token.string,
.token.char,
.token.builtin {
  color: #c41a16;
}
.token.inserted {
  background-color: #ccffd8;
}
.token.deleted {
  background-color: #ffebe9;
}
.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string {
  color: #9a6e3a;
}
.token.atrule,
.token.attr-value,
.token.keyword {
  color: #836c28;
}
.token.function,
.token.class-name {
  color: #DD4A68;
}
.token.regex,
.token.important,
.token.variable {
  color: #5c2699;
}
.token.important,
.token.bold {
  font-weight: bold;
}
.token.italic {
  font-style: italic;
}
</style>
<style type="text/css">
body {
  font-family: sans-serif;
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 1.5;
  box-sizing: border-box;
}
body, .footnotes, code { font-size: .9em; }
li li { font-size: .95em; }
*, *:before, *:after {
  box-sizing: inherit;
}
pre, img { max-width: 100%; }
pre, pre:hover {
  white-space: pre-wrap;
  word-break: break-all;
}
pre code {
  display: block;
  overflow-x: auto;
}
code { font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace; }
:not(pre) > code, code[class] { background-color: #F8F8F8; }
code.language-undefined, pre > code:not([class]) {
  background-color: inherit;
  border: 1px solid #eee;
}
table {
  margin: auto;
  border-top: 1px solid #666;
}
table thead th { border-bottom: 1px solid #ddd; }
th, td { padding: 5px; }
thead, tfoot, tr:nth-child(even) { background: #eee; }
blockquote {
  color: #666;
  margin: 0;
  padding-left: 1em;
  border-left: 0.5em solid #eee;
}
hr, .footnotes::before { border: 1px dashed #ddd; }
.frontmatter { text-align: center; }
#TOC .numbered li { list-style: none; }
#TOC .numbered { padding-left: 0; }
#TOC .numbered ul { padding-left: 1em; }
table, .body h2 { border-bottom: 1px solid #666; }
.body .appendix, .appendix ~ h2 { border-bottom-style: dashed; }
.footnote-ref a::before { content: "["; }
.footnote-ref a::after { content: "]"; }
section.footnotes::before {
  content: "";
  display: block;
  max-width: 20em;
}

@media print {
  body {
    font-size: 12pt;
    max-width: 100%;
  }
  tr, img { page-break-inside: avoid; }
}
@media only screen and (min-width: 992px) {
  pre { white-space: pre; }
}
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
</head>
<body>
<div class="frontmatter">
<div class="title"><h1>A tutorial on the cumulative calibration assessment and the cumulcalib package</h1></div>
<div class="author"><h2>Mohsen Sadatsafavi</h2></div>
<div class="date"><h3>2024-06-03</h3></div>
</div>
<div class="body">
<h2 id="introduction">Introduction</h2>
<p><em>cumulcalib</em> is an R package for the implementation of the cumulative calibration assessment for risk prediction models.</p>
<p>In order to use <em>cumulcalib</em> efficiently you should be reasonably familiar with the underlying statistical methodology. Please visit the related publication (Sadatsafavi and Petkau, Statistics in Medicine, 2024 <a href="https://doi.org/10.1002/sim.10138">https://doi.org/10.1002/sim.10138</a>).</p>
<p>We illustrate the use of this package, as well as basic interpretations of the cumulative calibration plots, through a running example.</p>
<h2 id="setup-a-running-example-based-on-gusto-data">Setup: A running example based on GUSTO data</h2>
<p>We use data from the GUSTO-I study which is widely used in predictive analytics. These data are available from the <em>predtools</em> package,</p>
<pre><code class="language-r">  library(predtools)
  data(gusto)
  set.seed(1)
</code></pre>
<p>The outcome is 30-day mortality (we denote it by \(y\)). We also convert the Killip score, a measure of the severity of heart failure, to a binary variable (cut off &gt;1):</p>
<pre><code class="language-r">  gusto$y &lt;- gusto$day30
  gusto$kill &lt;- (as.numeric(gusto$Killip)&gt;1)*1
</code></pre>
<p>We will develope and validate a risk prediction model for 30-day mortality after a heart attack based on these data. To create a semi-realistic scenario, we use the non-US sub-sample of the data for model development and the US sub-sample for model validation, and fit a logistic regression model on the development sample.</p>
<pre><code class="language-r">  dev_data &lt;- gusto[!gusto$regl %in% c(1, 7, 9, 10, 11, 12, 14, 15),] #The regl variable contains location codes
  val_data &lt;- gusto[gusto$regl %in% c(1, 7, 9, 10, 11, 12, 14, 15),]
  model &lt;- glm(y ~ age + miloc + pmi + kill + pmin(sysbp,100) + pulse, data=dev_data, family=binomial(link=&quot;logit&quot;))
</code></pre>
<p>The prevalence of the outcome in the development and validation samples are, respectively, 0.07 and 0.07. Here are the coefficients of the model:</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="right">Coefficients</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">(Intercept)</td>
<td align="right">-2.0841861</td>
</tr>
<tr>
<td align="left">age</td>
<td align="right">0.0781423</td>
</tr>
<tr>
<td align="left">milocOther</td>
<td align="right">0.4026548</td>
</tr>
<tr>
<td align="left">milocAnterior</td>
<td align="right">0.5773049</td>
</tr>
<tr>
<td align="left">pmiyes</td>
<td align="right">0.4677806</td>
</tr>
<tr>
<td align="left">kill</td>
<td align="right">0.7665919</td>
</tr>
<tr>
<td align="left">pmin(sysbp, 100)</td>
<td align="right">-0.0774778</td>
</tr>
<tr>
<td align="left">pulse</td>
<td align="right">0.0182409</td>
</tr>
</tbody>
</table>
<p>We use this model to predict the outcome in the validation sample:</p>
<pre><code class="language-r">  val_data$pi  &lt;- predict(model, type=&quot;response&quot;, newdata=val_data)
</code></pre>
<p>Letâ€™s start with the conventional calibration plot for this model, which is an estimate of the average value of the true risk at a given level of predicted risk (using the <em>calibration_plot</em> function of the <em>predtools</em> package):</p>
<pre><code class="language-r">  predtools::calibration_plot(val_data, obs=&quot;y&quot;, pred=&quot;pi&quot;)
#&gt; $calibration_plot
</code></pre>
<p><img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-7" />
The model seems to be well calibrated. One issue with such a plot is that it generally requires binning (as done above) or smoothing. This is because predicted risks often have many levels, and within each level of predicted risk only a few, and mostly only one, \(y\) is observed. This requirement makes this assessment somewhat subjective: whether to use binning or smoothing. If the former, how many bins? If the latter, which smoothing method, and with which tuning parameter(s)?</p>
<h2 id="objective-assessment-of-calibration-on-the-cumulative-domain">Objective assessment of calibration on the cumulative domain</h2>
<p>The cumulative calibration assessment is based on the behavior of standardized partial sum of <strong>prediction errors</strong> (i.e., \(y-\pi\), after ordering the data ascendingly on \(\pi\)). The promise is that if the model is calibrated, the resulting partial sum, after suitable standardization, will converge to the Brownian motion in the [0,1] interval. This approach does not require any regularization.</p>
<p>Details of such standardization is provided in the original publication. In brief, for the convergence to Brownian motion to work, the â€˜timeâ€™ jump at step i should be proportional to the variance of \(y_i\), which, under the hypothesis that the model is calibrated, is \(\pi_i(1-\pi_i)\).</p>
<h3 id="using-cumulcalib-package-for-calibration-assessment">Using <em>cumulcalib</em> package for calibration assessment</h3>
<p>To assess cumulative calibration using this approach via the <em>cumulcalib</em> package, we use a simple function call and store the results:</p>
<pre><code class="language-r">  library(cumulcalib)
  res &lt;- cumulcalib(val_data$y, val_data$pi) 
</code></pre>
<p>Letâ€™s explore what type of results this call returns:</p>
<pre><code class="language-r">summary(res)
#&gt; C_n (mean calibration error): -0.00156276638623442
#&gt; C* (maximum absolute cumulative calibration error): 0.00200906446334097
#&gt; Method: Two-part Brownian Bridge (BB)
#&gt; S_n (Z score for mean calibration error) -1.00908104947695
#&gt; B* (test statistic for maximum absolute bridged calibration error): 1.02844827843831
#&gt; Component-wise p-values: mean calibration=0.312935765573505 | Distance (bridged)=0.240744428186226
#&gt; Combined p-value (Fisher's method): 0.270143602790971
#&gt; Location of maximum drift: 22402  | time value: 0.888235817046906  | predictor value: 0.333472525720666
</code></pre>
<p>The following elements are returned:</p>
<ul>
<li>
<p>\(C_n\): sample estimate of mean calibration error ($E(y-\pi)$)</p>
</li>
<li>
<p>\(C^*\) maximum absolute cumulative prediction error, divided by the number of observations. \(C^*\) is a â€˜distanceâ€™ metric, similar to metrics such as Emax or the Integrated Calibration Index.</p>
</li>
</ul>
<p>The other components in the summary depend on the <em>Method</em> requested for inference on model calibration. The default method is the Brownian Bridge test, which returns the following:</p>
<ul>
<li>
<p>\(S_n\): the Z score for mean calibration error, obtained as \(\frac{nC_n}{\sqrt{\sum_1^n \pi_i(1-\pi_i)}}\). Note that the denominator is the square-root of total variance if the model is calibrated.</p>
</li>
<li>
<p>\(B^*\): this is the maximum distance of the random walk from the line that connects its start and end (the bridge line, hence the â€˜bridgeâ€™ test). Under the null hypothesis that the model is calibrated, \(B^*\) follows the Kolmogorov distribution.</p>
</li>
<li>
<p>Component-wise p-values: These are individual p-values for each component of the test. The first one is the Z-test for mean calibration (testing if the average predicted and observed risks are equal). The second one is the test of the deviation of the random walk from the line that connects its origin and end (bridged distance).</p>
</li>
<li>
<p>Combined p-value: This is the unified p-value for moderate calibration (based on Fisherâ€™s method)</p>
</li>
<li>
<p>Location of maximum drift: This provides information about the location that the maximum drift of the random walk occurs (corresponding to \(C^*\)). The rank of the observation, time, and predictor values at this point are reported.</p>
</li>
</ul>
<p>Note: the Brownian bridge test operates by combining two statistic: \(C_n\), and maximum absolute deviation of the random walk from the line that connects its origin and end points. The test statistic related to the former is , and \(B^*\) for the latter, which has a Kolmogorov distribution under the null hypothesis. Because it can be shown that these two statistics are independent, one combined p-value can be generated using the Fisherâ€™s method.</p>
<p>Based on the above results, both mean calibration p-value, and the bridged random walk p-value show that the data are compatible with the model being calibrated in this sample. Indeed, the combined p-value of 0.2701436 also indicated lack of strong evidence against the model being calibrated for the US population.</p>
<h3 id="graphical-assessment-of-calibration-using-cumulcalib-package">Graphical assessment of calibration using <em>cumulcalib</em> package</h3>
<p>The returning object from the function call can be directly plotted:</p>
<pre><code class="language-r">  plot(res)
</code></pre>
<p><img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-10" /></p>
<p>The X axis is the â€˜timeâ€™ value (running from 0 to 1). The corresponding predicted values are shown on the second X-axis on top. The default Y axis is the standardized sum (cumulative sum divided by the square root of the sum of variance of predicted risks). The second Y axis provides â€˜scaledâ€™ cumulative sum (divided by the number of observations). This means the terminal value of the random walk can be marked on the second Y-axis axis to identify mean calibration error.</p>
<p>The blue and red vertical lines, respectively, show the terminal value of the random walk and its maximum bridged deviation (given the default method, Brownian bridge, is used). The dotted lines of the same color mark the critical value of the test (by default at 5% significance level, see the documentation for the cumulcalib() function on how to disable inference lines or change significance level).</p>
<p>Here it is obvious that neither the terminal value (mean calibration error) nor the maximum deviation reach statistical significance.</p>
<h2 id="how-do-different-forms-of-miscalibrations-look-on-the-cumulative-calibration-plot">How do different forms of miscalibrations look on the cumulative calibration plot?</h2>
<p>The above results present how a calibrated model will look like. Letâ€™s test how different forms of miscalibration present themselves on the cumulative calibration graph.</p>
<h3 id="a-model-that-underestimates-the-risk">A model that underestimates the risk</h3>
<p>Letâ€™s start with a model that under-estimates the risk. We mimic this by applying an odds-ratio of 0.75 to predicted risks.</p>
<pre><code class="language-r">  val_data$pi2 &lt;- val_data$pi*0.75/(1-val_data$pi*(1-0.75)) #One-shot transformation of risk to odds and back
  res &lt;- cumulcalib(val_data$y, val_data$pi2) 
  predtools::calibration_plot(val_data, obs=&quot;y&quot;, pred=&quot;pi2&quot;)
#&gt; $calibration_plot
</code></pre>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAWgAAADYCAMAAADxhokmAAAAgVBMVEUAAAAAADoAAGYAOmYAOpAAZrYzMzM6AAA6ADo6AGY6OgA6OmY6OpA6ZmY6kNtmAABmADpmAGZmOgBmOpBmtttmtv+AsdOQOgCQOjqQOmaQtpCQ2/+2ZgC2/7a2/9u2///bkDrbtmbb25Db/7bb/9vb////tmb/25D//7b//9v///+uLOt/AAAACXBIWXMAAAsSAAALEgHS3X78AAAIVklEQVR4nO2dbWObNhCAlSxO0i2zk2447ewubrrYjv7/DxwCCQkQIAl06OWeT2oiWe5T9TgEHIQiIJC1v0AuoGggUDQQKBoIc9H4TzILFA0EigYCRQOBooFA0UCgaCBQNBAo2gN7zc9QtAdQNBAoGggUDYSx6OuO3H1UrTMht28jPREdpqI/Xwt62rDW5csbb6FoC0xFX1/eKsU1ooWiTdmbir48fdDr84H/qVrR9/f3KNqQ/V5nWqfvfCdFXx5uDsM9EQ3motsrWrRQtCnGoaMdo+mxGOyJaDHPOrY811CDCIo2xjKPrnI7QjBGW4NnhkCgaCBQNBAoGggUDQSKXhEUDQSKBgJFA4GigUDRQKBoIFA0ECgaCBQNBIr2DanFoWi/EKENRfuESGko2huEqMpQtCdIxxeK9kJXM4r2Ql8zil4eotOMopdGb5mi6GUZ1IyiF2QgZojfmn/O/K+SMqOWKYpeiCnNKHoJxmOG6GT+cTO+SsqYWKYoei6GmlH0PIw1o+gZGIVm2dtDzyywskxRtCO2mlG0C3YxQwxqWqdyfPOE/WjPvHGxTBV98gnOqZ5Z46hZFf0yvJjbPfPFKWaIsU2LPyBr0DNTZlim6oreYYweY55mzDoMmatZ1ceWNF/QstTP5YGQotszN+aEZvkhosHq+1QP2aulflgqcnnM+6H7JSzTbtZRpx6yjMSZ6c66jMRCmvUrWlMYJc9SP4vEDPFZTUvGaLVKR1W8o9MzExa0TPX61BV93W1HeibMspobfdeXHzKPVkr9XB6KTs8sWDJmiI/U/EyW+lE8ZyR6ectUn3XIUj/Vjh7JK+vwornR9/laKRXnKSM908ZDzBCfLBq4e+dtMdef3bSy3/j3qbm98X8szhuDnmniV3M7dJy2Y/EjZdH+QrOcQjQ+vx3OmzxF+7dMVX3nu/9eydakZ1qAaM5+4x8gZoiZRENuakz1TAcwy7Slr8zvRpKO9ERDau7qO2eTR8PFDDGhbGa0oqEt0zxj9Aqac9zrWEVzdqLBQ7OcuWllcEvYapZpVreErak5nzPD9WKG+AJNq1zSf38buUc6ZtFrW6btG2iOBbvRYLJndASguZ11HIsEt0lXjxmc9oo+p3ZxNhDLdOC23Yme0RCO5qSzjpA0t66wbMo1PXLSEtTXniSU0NygXjM8bVLJOkKzTDtZR5hXwfVvvBwhQM3qiv7+4/kQ6Iq28RxczOAoMZrc/Rp7ejYK0YFappFkHaaiw9XczaNHzleCFx1qzODoHhaa6AmOybEwbMt04Eb08Z7QGGQdwWvuXmEJ8m7SSdERaJYPC+3qO/6DvMIy6jnw0NwQedYRiWUaueh4NCv6WB2Dm7FqP6GJjiVmcMSXre66u+7C3L3TiI7LMpWPv9WXZWPZ64hOs8w6+JOcMeTRkcUMThQrWiVKy3QgRstSP1Q8fR+I6Fg167MOWeqHbZ7ehiM6Xs16fUoZiePNP6Gs6DhDc4Puy7dK/dTGVy/1E7dlqhfdKvXjL0ZbXAuMXrPxih7oORMzz5HHDM5EjF5fdBKWqV6fLPVD1xadiuYBfU2pH+pV9FSITiNmcFbcJp04GKZkmYYrOjHN6278D3tOTvPKV1j0opMKzQ3BiU7SMg1OdKqawxKdZszghJN1pGyZhnO7QeKaAxGddMzggIgePwfMwDIFW9EZnQIOsLLoXDRDidZHjhxCc8N6MTony3Q90ZlpXil0ZBUzOCscDDO0TFcQnadmaNE5xgyOH9H79uGP/ylfy9Tfis4+neviSXQ3ncs4ZnD8hQ51aO6WKYho1MzwHjpQc43fgyGG5gafotGywpKiZfbMGqi5xcIrWoRmjBldFhGtrOS6K1rusdCKlhEDNetZRrQMzRgzBlg2dKDlQZYUXWq2q22ZE8uFDkL24zfK5M1M0UIthuYpFhHNFvNi3yhR3EXvBbiYTXAUXa5gsZhRsxFuouVixsOfIe6iKcYMG0YeUW63uqGD4Gq2QidalvpRi/60euJitkUnTJaRUAtKKD1Rsz06ZbIwStNSS/2gZhd00mSpH7XoT90T0zlHDFc074mWnbGJ0ah5BvqsY9tkHbLoD2qexUgezZaymkcL7okr7iNjm1QdOiJ6nHvXf9QZI2ObtD8URQMNxcALBIoGAkUDgaKBMBXd2zlVq6bbjTyR8dc164byipIOk/KRLpOy2uWFxaT9ocqshqJ7O6fqBqrdyOqlXJaT8srsDpOKmu4Ok7K9h8vjwXjS/lB1VkPRvbPyVkVeq5H8vQ1Wk/LK7A6T8pEuk1ZvaDsWxpP2h6qzGoru7TO1akxbjazef2a0vnp1rB0m5SMdJ7X6m/aHqrMaiu7tnLaqpluNZP+lzBZYrzK7w6R8pOOkbK/HeNL+UHVW+BVd/dQoZC64ot0mve623XVqNVSdFT5Gq7ObDqU8ADjEaFvRytDLQ9H9LLuh6qzGWUdn57RVNd1qJPsP9vnd5Iv3KrM7TEpl0LGdlMsynrQ/VJ3VLo9Wdk4tU1pl5GnifX66oW55tDLSYdJTtclZWOfRylBlVjwzBAJFA4GigUDRQKBoIFA0EHGJ1rzq+fO1EO8Vvf71MfaK0XWJTHTp8dxOatnepPLbYIlP9OXp/Y+vt29nQjbsPOS3r2xFl0v99t9Xcvf+9FGeJGzp5c8dMTqbAyM+0ee798dD1ToW5UlYebZ7efr1fChPfpnwp/cvb2zPq96NCYjIRFcxutLNznG3py3btCntVkGjEv1zU//ow3yvH4TIRAuh9TUMiqI9IUXXF/NYhNjx0HFmAboJHSh6FlI0FQfDm9/FwbB0zg+GBUXR2YKigUDRQKBoIFA0ECgaCBQNxP9wgsNkGOmbOAAAAABJRU5ErkJggg==" alt="plot of chunk unnamed-chunk-11" /></p>
<pre><code class="language-r">  plot(res)
</code></pre>
<p><img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-11" /></p>
<p>As can be seen above, when predicted risks are systematically smaller than actual risks, prediction errors are generally positive, resulting in a generally ascending curve. Clearly, the Z-test component of the bridge test is rejected at 0.05 level (the corresponding p-value is 4.6582653 Ã— 10<sup>-20</sup>). However, as can bee see by the red markings on the graph, the bridge component is not affected by such systematic error (the corresponding p-value is 0.2022575). As the overall p-value for moderate calibration is affected by both, it remains significant (p-value: 0). As such, the null hypothesis that the model is moderately calibrated is rejected at 0.05 significance level.</p>
<h3 id="a-model-that-overestimates-the-risk">A model that overestimates the risk</h3>
<p>We mimic this by applying an odds-ratio of 1.25 to predicted risks.</p>
<pre><code class="language-r">  val_data$pi2 &lt;- val_data$pi*1.25/(1-val_data$pi*(1-1.25)) #One-shot transformation of risk to odds and back
  res &lt;- cumulcalib(val_data$y, val_data$pi2) 
  predtools::calibration_plot(val_data, obs=&quot;y&quot;, pred=&quot;pi2&quot;)
#&gt; $calibration_plot
</code></pre>
<p><img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-12" /></p>
<pre><code class="language-r">  plot(res)
</code></pre>
<p><img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-12" /></p>
<p>Here, the opposite happens: when predicted risks are systematically larger than actual risks, prediction errors are generally negative, resulting in a generally descending curve. Again, the Z-test component of the bridge test is rejected at 0.05 level (the corresponding p-value is 5.1912618 Ã— 10<sup>-19</sup>), but the bridge component is not affected by such systematic error (the corresponding p-value is 0.4221737). Again, as the overall p-value for moderate calibration is affected by both, it remains significant (p-value: 0). As such, the null hypothesis that the model is moderately calibrated is rejected at 0.05 significance level.</p>
<h3 id="over-fittedd-model">Over-fittedd model</h3>
<p>To demonstrate how an over-fitted model might look, we refit the model based on only a sub-sample of 500 rows from the development sample. The intuition is that because of the small development sample, the model might not be calibrated. In particular, it might be over-fitted.</p>
<pre><code class="language-r">  dev_data2 &lt;- dev_data[sample(nrow(dev_data), 500, replace=F),]
  model2 &lt;- glm(y ~ age + miloc + pmi + kill + pmin(sysbp,100) + pulse, data=dev_data2, family=binomial(link=&quot;logit&quot;))
  val_data$pi2  &lt;- predict(model2, type=&quot;response&quot;, newdata=val_data)
</code></pre>
<p>Letâ€™s look at the calibration plot</p>
<pre><code class="language-r">  predtools::calibration_plot(val_data, obs=&quot;y&quot;, pred=&quot;pi2&quot;)
#&gt; $calibration_plot
</code></pre>
<p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAWgAAADYCAMAAADxhokmAAAAgVBMVEUAAAAAADoAAGYAOmYAOpAAZrYzMzM6AAA6ADo6AGY6OgA6OmY6OpA6ZmY6kNtmAABmADpmAGZmOgBmOpBmtttmtv+AsdOQOgCQOjqQOmaQtpCQ2/+2ZgC2/7a2/9u2///bkDrbtmbb25Db/7bb/9vb////tmb/25D//7b//9v///+uLOt/AAAACXBIWXMAAAsSAAALEgHS3X78AAAIKUlEQVR4nO2dfWObNhDGlcxO0i2zm27G3ezOXrqAc9//Aw4wtgSWQW9IJ+mef+o2Cpx+eXqcBDkYkLyIhQ4gFxFoTyLQnkSgPUkdNP1IBOnDINAGYgYsCLS+jEgQaF2Z2BkItLZMMRBoLRnaGQi0niwYSL/1tGaLj/ZTydjjwfokicjcziDH97ndwHHZfKq+HLpPBFoDQKH43ae3Q4v4rMunzEHr2FkVdPX6Aaevu+5vraOfnp7yBq01e1XQ5YKDrp4fdganSkya2dnM0ZdPGYPWnbpZjob9xuhsyUi/2FAF/blddbWGmERyBW0wb1XQXR3d1naM5Z2jjWpnZdDyUxqcMXoZTbog0JoyWwoWhYw0gb4vwxkTaD2Z72xQ6tCRzXQJtLKsNuoItLIs50qg1WRnZyDQirKfKIFWkLWdgUCryMksCfSUXNgZCPSk5pwigb7KkZ3vHX2GkXFq5vkR6LPmtTMQ6E7zT45Agwc7A4Fu5GVmBNqHnYFAe5tW5qA92RlyB+1xTjmD9mdnyBq03wllC9qrnSFf0N5nkydo33aGTEGHmEqGoAPYGXIEHWgeuYEOY2fIDnS4SWQFOpidIS/QQWeQD+iQdoaMQIcOPxPQge0MuYBGEHsOoMPbGbIAjSPw5EGjsDOI+I6M8b4+oyNjEpqor4HwvhFTIyMSFjuDCPqNm5k3r6qeGdsMRsYjTCHzWLq2HCA2r2psXr1E2kYCkZ1BdPT6mqN5Y5SywR1pYxRk8crCkbT6ia55FS47gwi6sfS56BD7zrTtaAYjIxC+YK8RNYm5Rdx39Gm9Go7EL3R2hmHVcS49hOZV1fPmZiR6oYxU5mjevErgjDN8iTDaGeQ5mjevaleLLKqqA2uYie11ILUzXPGd3n6sE9jrQBxjSo7Ga2eQVx0TI7EKd4BddJ/b9rJ32UsaGYlVqO0Md3bvxkeiFO7oIJWNf+x2hv7G/35TLhVG4hPi0K4SU8dxFeXFMAI7g7gE/74rlzGCxhrXQDzMcvHflq1URmJSHHaG6BcsKIOSSriVNeLm3kg8isbO0MNX13cjRQdC0PgiGlE/2DKiOjomO0PEjkYWzqQizdGR2Rli3evAFIuiYgQdn51B/kjY1MjAQhOIlmSPhE2MDKso7QzxrQxxRGGg3uMGf34feUYawxRjtTP0H6DZb5qHwSZHhhOCEIwlVh37Dept0ojtDENHl4hvzoY+v6Wkj4RNjAyhuO0MuKsO4eVesWPu3WFZ1p4eWbQEmOsFdPR2hv49w+MSWdVRBDuze/WqDmx3wVvQKdgZREf/9ePrDqGj08Dcy9Fs8XPst2eDXAwTsTOgrjqKokgG87COHlmvBADNmOylU5FK9stCEyN9iUlfkhur0D6I3mTnJEG3d1jwPE3ani1B0Of7K2jusHTFRoKgnY601uVUBHpW8do5SdBNr5mHsW4/vkDz8yRZdbRP3Z3WwXfv0lkKDnT59bfzbdngex2pYhZ+Rfkg/DE2ctZg0uUsdzTvEgaXxh0+QCeMWZ6jeZewZk/v0RPolO0M8qpD6ECzf/jbk6PTxiyfX69L2Jn43F3CErczyEH3uoR5ydHJY1Z29J2RjmLIgLMUn5Cj3YO+Xe7lgFk+S94lDGZw9AB0FnaGO/iuXcJgdtCZYA6xeyeCzsXOEAC0mKPzwewfdFEUKT1Rp65woLPCHC515GVnCHYxzA1zINDZ2RnCgM4QcwjQOdoZAoBO6cFFHXkGnamdYVbQkscyssU8r6OHoPO1M3gFnTNmj6kjazvDnKCF7SOD705OfkDnbmfwlDoIs5eLIdm50fygCXOruUGTnTvNnKMJ80Wz7nWQnbncgh6sUXSDSVmOHS0uUYizqNkcTZj7cgpaeJaAOA80D2jCfKM5UgfZWSInoHlqTqkLkluZgi7kf0upC5JbOQF9dXRSXZDcyhB0b2VCxYaCzEBztM2fVGwoyAVoKjYUZJk6OuJUbEzK8mJ4Bp1Uy8WZZFtHU3ZWlPWChW6jqMkYdG3lLmuQnVVknKPPArKzoqxBE2Y1WaYOsrOq7EATZmVJUfHmVUIbq9uRZGcNyVjx5lViG6ubkYRZRzJavDGK2CJlMJLsrCcZLt7q5/rppnkVYdaUDBhvXiW2sRJHkp21pejo/kjCrC+DHE12NpG86lhdqw7exoqJemJulfLx7oMWmleJ7WBFPbn4IWd1PMM0gG8i2I9H+daTCLQnEWhPItCepAlauq9nIWmTeyfHaxqPj7yDQ/t45fg7pielB1q+r2cueZN7F8dr1rPVy9h7ZfSO17jAar56oOVrRnPJm9y7OF77erW9raX7s7Sarx5o+S6IueQtwR0dz3V8Ph0t39czl7zJvaPjNfsHDo9XPY++4WpK6Tr6tLbm7PJ/CJoc7QS0cLzq2b7mGM7SJufrVh2yfT1zyZvcuzieE87C8axTpVEdPbavZ3o8l3V0faRju0NpDZvHd5x4C+GUaGXoSQTakwi0JxFoTyLQnkSgPSku0JJXPX9uN5c35Z7++Bh7aW5YRQa65lj2y/dmJ1P4KlrFB7p6ff/t2+OhZKxesh3ZL98aR9dWf/xnyxbvrx/1ymIF1e9rZr1udar4QJeL95dd+2m/qZds9Vq7ev1ZL46Pywb46/uXQ71Urr8w9kboAIoMdJujW9zNCnt1XDU7PTXdNmm0oP9dnv/po3sxNBZFBvoC9HwHBQj0TOKgq5ddU2/UGWLdpY6ySdDX1EGgrcRBw+Vi+PDr5WJYM+8uhhsg0NmKQHsSgfYkAu1JBNqTCLQnEWhP+h8aRe6R1nEgswAAAABJRU5ErkJggg==" alt="plot of chunk unnamed-chunk-14" /></p>
<p>The model is indeed not as well calibrated as the model based on the full development sample. Letâ€™s repeat the cumulative calibration exercise</p>
<pre><code class="language-r">  res2 &lt;- cumulcalib(val_data$y, val_data$pi2)
  summary(res2)
#&gt; C_n (mean calibration error): 0.000155141189372822
#&gt; C* (maximum absolute cumulative calibration error): 0.00834106759839242
#&gt; Method: Two-part Brownian Bridge (BB)
#&gt; S_n (Z score for mean calibration error) 0.106201501405016
#&gt; B* (test statistic for maximum absolute bridged calibration error): 5.66522040991453
#&gt; Component-wise p-values: mean calibration=0.915422479736339 | Distance (bridged)=0
#&gt; Combined p-value (Fisher's method): 0
#&gt; Location of maximum drift: 18992  | time value: 0.420294629063076  | predictor value: 0.106004714711078
  plot(res2)
</code></pre>
<p><img src="data:image/png;base64,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" alt="plot of chunk unnamed-chunk-15" /></p>
<p>Here, despite the fact that average predicted risks are close to the average actual risks (notice the terminal position of the random walk), miscalibration is quite obvious: the model seems to be making under-estimated risks at low values (the increasing trend of cumulative prediction error), followed by overestimating the risk later (the declining curve). This inverse U shape is a typical signature of an over-fitted model.</p>
<p>If we repeat the similar steps for inference, we will obtain the following p-values: 0.9154225 for mean miscalibration, 0 for the bridge component, and 0 for the unified test. Unlike models that systematically under-predict or over-predict the risk, here it is the bridge component of the test that catches the miscalibration.</p>
</div>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" defer></script>
<script src="https://cdn.jsdelivr.net/combine/npm/katex/dist/katex.min.js,npm/katex/dist/contrib/auto-render.min.js,npm/@xiee/utils/js/render-katex.js" defer></script>
</body>
</html>
